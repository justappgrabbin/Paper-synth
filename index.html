<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Self-Evolution Playground</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
      min-height: 100vh;
      color: #fff;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 3em;
      background: linear-gradient(90deg, #00f2fe 0%, #4facfe 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .status-bar {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .status-item {
      text-align: center;
    }

    .status-label {
      font-size: 0.9em;
      opacity: 0.7;
      margin-bottom: 5px;
    }

    .status-value {
      font-size: 1.3em;
      font-weight: 600;
    }

    .status-value.connected { color: #00ff88; }
    .status-value.disconnected { color: #ff4444; }

    .panel {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .panel h2 {
      font-size: 1.5em;
      margin-bottom: 20px;
      color: #4facfe;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 0.95em;
      opacity: 0.9;
    }

    .input-group input,
    .input-group textarea {
      width: 100%;
      padding: 12px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: #fff;
      font-size: 1em;
    }

    .input-group input::placeholder,
    .input-group textarea::placeholder {
      color: rgba(255,255,255,0.5);
    }

    .drop-zone {
      border: 2px dashed rgba(255,255,255,0.3);
      border-radius: 12px;
      padding: 60px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }

    .drop-zone:hover,
    .drop-zone.drag-over {
      border-color: #4facfe;
      background: rgba(79,172,254,0.1);
    }

    .drop-zone.processing {
      border-color: #00ff88;
      background: rgba(0,255,136,0.1);
    }

    .drop-zone-icon {
      font-size: 3em;
      margin-bottom: 15px;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .btn-primary {
      background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
      color: #000;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(79,172,254,0.3);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .btn-success {
      background: #00ff88;
      color: #000;
    }

    .btn-danger {
      background: #ff4444;
      color: #fff;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .log-container {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .log-entry {
      padding: 5px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-time {
      color: #888;
      margin-right: 10px;
    }

    .log-success { color: #00ff88; }
    .log-error { color: #ff4444; }
    .log-info { color: #4facfe; }
    .log-warning { color: #ffaa00; }

    .file-list {
      margin-top: 15px;
    }

    .file-item {
      background: rgba(255,255,255,0.05);
      padding: 10px 15px;
      border-radius: 6px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .file-name {
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .file-size {
      color: #888;
      font-size: 0.85em;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
      transition: width 0.3s ease;
      width: 0%;
    }

    .hidden {
      display: none;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üß† AI Evolution Playground</h1>
      <p>Drop ‚Üí Extract ‚Üí Deploy ‚Üí Evolve</p>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-grid">
        <div class="status-item">
          <div class="status-label">Supabase</div>
          <div class="status-value disconnected" id="supabase-status">Disconnected</div>
        </div>
        <div class="status-item">
          <div class="status-label">GitHub</div>
          <div class="status-value disconnected" id="github-status">Not Configured</div>
        </div>
        <div class="status-item">
          <div class="status-label">Model</div>
          <div class="status-value" id="model-status">None</div>
        </div>
        <div class="status-item">
          <div class="status-label">Evolution Stage</div>
          <div class="status-value" id="stage-status">Ready</div>
        </div>
      </div>
    </div>

    <div class="grid-2">
      <!-- Configuration Panel -->
      <div class="panel">
        <h2>‚öôÔ∏è Configuration</h2>
        
        <div class="input-group">
          <label>Supabase URL</label>
          <input type="text" id="supabase-url" placeholder="https://xxxxx.supabase.co">
        </div>

        <div class="input-group">
          <label>Supabase Anon Key</label>
          <input type="password" id="supabase-key" placeholder="Your anon/public key">
        </div>

        <div class="input-group">
          <label>GitHub Token (optional - for auto-deploy)</label>
          <input type="password" id="github-token" placeholder="ghp_xxxxx">
        </div>

        <div class="input-group">
          <label>GitHub Repo (username/repo)</label>
          <input type="text" id="github-repo" placeholder="yourusername/ai-playground">
        </div>

        <button class="btn btn-primary" onclick="saveConfig()">üíæ Save Configuration</button>
        <button class="btn btn-secondary" onclick="testConnections()">üîå Test Connections</button>
      </div>

      <!-- Model Upload Panel -->
      <div class="panel">
        <h2>üì¶ Model Deployment</h2>
        
        <div class="drop-zone" id="drop-zone">
          <div class="drop-zone-icon">üìÅ</div>
          <div><strong>Drop TinyLlama.zip here</strong></div>
          <div style="opacity: 0.7; margin-top: 10px;">or click to browse</div>
          <input type="file" id="file-input" accept=".zip" style="display: none;">
        </div>

        <div id="file-info" class="hidden">
          <div class="file-list" id="extracted-files"></div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
          </div>
        </div>

        <div style="margin-top: 20px;">
          <button class="btn btn-success" id="deploy-btn" onclick="deployModel()" disabled>
            üöÄ Deploy to GitHub
          </button>
          <button class="btn btn-secondary" onclick="clearModel()">üóëÔ∏è Clear</button>
        </div>
      </div>
    </div>

    <!-- Evolution Log -->
    <div class="panel">
      <h2>üìä Evolution Log</h2>
      <div class="log-container" id="log"></div>
    </div>
  </div>

  <script>
    // ============================================
    // STATE MANAGEMENT
    // ============================================
    let supabase = null;
    let currentModel = null;
    let extractedFiles = [];
    let config = {
      supabaseUrl: '',
      supabaseKey: '',
      githubToken: '',
      githubRepo: ''
    };

    // ============================================
    // LOGGING SYSTEM
    // ============================================
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.innerHTML = `<span class="log-time">[${time}]</span>${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // ============================================
    // CONFIGURATION
    // ============================================
    function loadConfig() {
      const saved = localStorage.getItem('ai-playground-config');
      if (saved) {
        config = JSON.parse(saved);
        document.getElementById('supabase-url').value = config.supabaseUrl || '';
        document.getElementById('supabase-key').value = config.supabaseKey || '';
        document.getElementById('github-token').value = config.githubToken || '';
        document.getElementById('github-repo').value = config.githubRepo || '';
        
        if (config.supabaseUrl && config.supabaseKey) {
          initSupabase();
        }
      }
    }

    function saveConfig() {
      config = {
        supabaseUrl: document.getElementById('supabase-url').value.trim(),
        supabaseKey: document.getElementById('supabase-key').value.trim(),
        githubToken: document.getElementById('github-token').value.trim(),
        githubRepo: document.getElementById('github-repo').value.trim()
      };

      localStorage.setItem('ai-playground-config', JSON.stringify(config));
      log('Configuration saved successfully', 'success');
      
      if (config.supabaseUrl && config.supabaseKey) {
        initSupabase();
      }
    }

    function initSupabase() {
      try {
        supabase = window.supabase.createClient(config.supabaseUrl, config.supabaseKey);
        document.getElementById('supabase-status').textContent = 'Connected';
        document.getElementById('supabase-status').className = 'status-value connected';
        log('Supabase connection initialized', 'success');
      } catch (error) {
        log(`Supabase error: ${error.message}`, 'error');
        document.getElementById('supabase-status').textContent = 'Error';
        document.getElementById('supabase-status').className = 'status-value disconnected';
      }
    }

    async function testConnections() {
      log('Testing connections...', 'info');
      
      // Test Supabase
      if (supabase) {
        try {
          const { data, error } = await supabase.from('models').select('count');
          if (error) throw error;
          log('‚úì Supabase connection OK', 'success');
        } catch (error) {
          log(`‚úó Supabase test failed: ${error.message}`, 'error');
        }
      } else {
        log('‚úó Supabase not configured', 'warning');
      }

      // Test GitHub
      if (config.githubToken && config.githubRepo) {
        try {
          const response = await fetch(`https://api.github.com/repos/${config.githubRepo}`, {
            headers: {
              'Authorization': `token ${config.githubToken}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          });
          
          if (response.ok) {
            log('‚úì GitHub connection OK', 'success');
            document.getElementById('github-status').textContent = 'Connected';
            document.getElementById('github-status').className = 'status-value connected';
          } else {
            throw new Error(`HTTP ${response.status}`);
          }
        } catch (error) {
          log(`‚úó GitHub test failed: ${error.message}`, 'error');
          document.getElementById('github-status').textContent = 'Error';
        }
      } else {
        log('‚úó GitHub not configured', 'warning');
      }
    }

    // ============================================
    // FILE HANDLING
    // ============================================
    function setupDropZone() {
      const dropZone = document.getElementById('drop-zone');
      const fileInput = document.getElementById('file-input');

      dropZone.addEventListener('click', () => fileInput.click());

      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
      });

      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('drag-over');
      });

      dropZone.addEventListener('drop', async (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          await handleFile(files[0]);
        }
      });

      fileInput.addEventListener('change', async (e) => {
        if (e.target.files.length > 0) {
          await handleFile(e.target.files[0]);
        }
      });
    }

    async function handleFile(file) {
      if (!file.name.endsWith('.zip')) {
        log('Please upload a .zip file', 'error');
        return;
      }

      log(`Processing ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)...`, 'info');
      document.getElementById('drop-zone').classList.add('processing');
      document.getElementById('stage-status').textContent = 'Extracting';
      
      try {
        const zip = await JSZip.loadAsync(file);
        extractedFiles = [];
        
        const fileList = document.getElementById('extracted-files');
        fileList.innerHTML = '';

        let processedCount = 0;
        const totalFiles = Object.keys(zip.files).length;

        for (const [filename, zipEntry] of Object.entries(zip.files)) {
          if (!zipEntry.dir) {
            const content = await zipEntry.async('blob');
            extractedFiles.push({
              name: filename,
              content: content,
              size: content.size
            });

            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
              <span class="file-name">${filename}</span>
              <span class="file-size">${(content.size / 1024).toFixed(1)} KB</span>
            `;
            fileList.appendChild(fileItem);
          }

          processedCount++;
          const progress = (processedCount / totalFiles) * 100;
          document.getElementById('progress').style.width = `${progress}%`;
        }

        currentModel = {
          name: file.name.replace('.zip', ''),
          files: extractedFiles,
          uploadedAt: new Date().toISOString()
        };

        document.getElementById('file-info').classList.remove('hidden');
        document.getElementById('deploy-btn').disabled = false;
        document.getElementById('model-status').textContent = currentModel.name;
        document.getElementById('stage-status').textContent = 'Ready to Deploy';
        
        log(`‚úì Extracted ${extractedFiles.length} files`, 'success');

        // Auto-save to Supabase
        if (supabase) {
          await saveModelToSupabase();
        }

      } catch (error) {
        log(`Extraction failed: ${error.message}`, 'error');
      } finally {
        document.getElementById('drop-zone').classList.remove('processing');
      }
    }

    function clearModel() {
      currentModel = null;
      extractedFiles = [];
      document.getElementById('file-info').classList.add('hidden');
      document.getElementById('deploy-btn').disabled = true;
      document.getElementById('model-status').textContent = 'None';
      document.getElementById('stage-status').textContent = 'Ready';
      document.getElementById('progress').style.width = '0%';
      document.getElementById('extracted-files').innerHTML = '';
      log('Model cleared', 'info');
    }

    // ============================================
    // SUPABASE INTEGRATION
    // ============================================
    async function saveModelToSupabase() {
      if (!supabase) {
        log('Supabase not configured - skipping save', 'warning');
        return;
      }

      try {
        log('Saving model metadata to Supabase...', 'info');
        
        const { data, error } = await supabase
          .from('models')
          .insert([
            {
              name: currentModel.name,
              file_count: currentModel.files.length,
              uploaded_at: currentModel.uploadedAt,
              status: 'extracted'
            }
          ])
          .select();

        if (error) throw error;

        log('‚úì Model saved to Supabase', 'success');
        currentModel.supabaseId = data[0].id;

      } catch (error) {
        log(`Supabase save error: ${error.message}`, 'error');
      }
    }

    async function updateModelStatus(status) {
      if (!supabase || !currentModel.supabaseId) return;

      try {
        await supabase
          .from('models')
          .update({ status })
          .eq('id', currentModel.supabaseId);
        
        log(`Model status updated: ${status}`, 'info');
      } catch (error) {
        console.error('Status update failed:', error);
      }
    }

    // ============================================
    // GITHUB DEPLOYMENT
    // ============================================
    async function deployModel() {
      if (!config.githubToken || !config.githubRepo) {
        log('GitHub not configured - cannot deploy', 'error');
        return;
      }

      if (!currentModel) {
        log('No model to deploy', 'error');
        return;
      }

      log('Starting GitHub deployment...', 'info');
      document.getElementById('stage-status').textContent = 'Deploying';
      document.getElementById('deploy-btn').disabled = true;

      try {
        const [owner, repo] = config.githubRepo.split('/');
        const branch = 'main';
        const modelPath = `models/${currentModel.name}`;

        // Create a commit with all files
        for (const file of currentModel.files) {
          const content = await file.content.arrayBuffer();
          const base64Content = btoa(
            String.fromCharCode(...new Uint8Array(content))
          );

          const filePath = `${modelPath}/${file.name}`;
          
          log(`Uploading ${file.name}...`, 'info');

          const response = await fetch(
            `https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`,
            {
              method: 'PUT',
              headers: {
                'Authorization': `token ${config.githubToken}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                message: `Deploy ${currentModel.name}: ${file.name}`,
                content: base64Content,
                branch: branch
              })
            }
          );

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.message || `Upload failed: ${response.status}`);
          }

          const progress = (currentModel.files.indexOf(file) + 1) / currentModel.files.length * 100;
          document.getElementById('progress').style.width = `${progress}%`;
        }

        log(`‚úì Deployed ${currentModel.files.length} files to GitHub`, 'success');
        document.getElementById('stage-status').textContent = 'Deployed';
        
        if (supabase) {
          await updateModelStatus('deployed');
        }

        // Show repo link
        const repoUrl = `https://github.com/${config.githubRepo}/tree/${branch}/${modelPath}`;
        log(`View deployment: <a href="${repoUrl}" target="_blank" style="color: #4facfe;">${repoUrl}</a>`, 'success');

      } catch (error) {
        log(`Deployment failed: ${error.message}`, 'error');
        document.getElementById('stage-status').textContent = 'Deploy Failed';
      } finally {
        document.getElementById('deploy-btn').disabled = false;
      }
    }

    // ============================================
    // INITIALIZATION
    // ============================================
    window.addEventListener('DOMContentLoaded', () => {
      log('AI Evolution Playground initialized', 'info');
      loadConfig();
      setupDropZone();
    });
  </script>
</body>
</html>
```

---

## What This Does

### ‚úÖ **Easy Mode (Your Way)**
1. **Paste API keys once** ‚Üí saves in localStorage
2. **Drop TinyLlama.zip** ‚Üí auto-extracts all files
3. **Click "Deploy"** ‚Üí pushes entire model to GitHub
4. **Supabase tracks** ‚Üí model metadata, status, history

### üî• **The Magic Flow**
```
Drop .zip ‚Üí JSZip extracts ‚Üí Files stored in memory
         ‚Üì
    Save to Supabase (metadata)
         ‚Üì
    Push to GitHub (one commit per file)
         ‚Üì
    Update Supabase (status: deployed)
```

---

## Setup Steps

### 1Ô∏è‚É£ **Get Your Keys**
- **Supabase**: Go to your project ‚Üí Settings ‚Üí API ‚Üí Copy URL + anon key
- **GitHub**: Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Generate (needs `repo` scope)

### 2Ô∏è‚É£ **Create Supabase Table**
Run this in your Supabase SQL editor:
```sql
CREATE TABLE models (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  file_count INTEGER,
  uploaded_at TIMESTAMPTZ,
  status TEXT DEFAULT 'extracted',
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 3Ô∏è‚É£ **Use It**
1. Save the HTML file anywhere
2. Open in browser
3. Paste your keys in Configuration
4. Drop your TinyLlama.zip
5. Watch it work

---

## What You Get

### **Status Bar** (Real-Time)
- ‚úÖ Supabase: Connected/Disconnected
- ‚úÖ GitHub: Configured/Not Configured  
- ‚úÖ Model: Current model name
- ‚úÖ Stage: Ready ‚Üí Extracting ‚Üí Deployed

### **Auto-Logging**
Every action logs with timestamp:
```
[3:45:22 PM] Processing TinyLlama.zip (147.82 MB)...
[3:45:25 PM] ‚úì Extracted 47 files
[3:45:26 PM] ‚úì Model saved to Supabase
[3:45:27 PM] Uploading config.json...
[3:45:30 PM] ‚úì Deployed 47 files to GitHub
```

### **File Preview**
Shows every extracted file with size:
```
tokenizer.json          234.5 KB
pytorch_model.bin       2.3 MB
config.json            1.2 KB
```

---

## Why This Works

### **No Build Step**
- Pure HTML/CSS/JS
- CDN-loaded libraries (JSZip, Supabase)
- Works offline after first load

### **Your Workflow**
- Drop zip ‚Üí Everything happens
- No terminal commands
- No manual GitHub commits
- No file management

### **Fail-Safe**
- Validates connections before deploy
- Logs every step
- Saves state in localStorage
- Can retry failed deploys

---

## What Happens Behind the Scenes

### **When You Drop a .zip:**
1. JSZip loads entire archive into memory
2. Extracts all files as Blobs
3. Stores file list + metadata
4. Saves to Supabase (tracking)
5. Enables "Deploy" button

### **When You Click Deploy:**
1. Reads each file from memory
2. Converts to base64 (GitHub API requirement)
3. Commits each file to your repo
4. Updates progress bar
5. Marks as "deployed" in Supabase

---

## Customization Points

### **Want Auto-Deploy?**
Add this after extraction:
```javascript
// In handleFile() function, after log('‚úì Extracted...')
if (config.githubToken && config.githubRepo) {
  await deployModel(); // Auto-deploy when ready
}
```

### **Want Different Branch?**
Change line:
```javascript
const branch = 'main'; // ‚Üí 'dev' or 'models' or whatever
```

### **Want to Track More Data?**
Modify Supabase insert:
```javascript
{
  name: currentModel.name,
  file_count: currentModel.files.length,
  total_size_mb: extractedFiles.reduce((sum, f) => sum + f.size, 0) / 1024 / 1024,
  model_type: 'llama', // Custom field
  uploaded_at: currentModel.uploadedAt,
  status: 'extracted'
}
